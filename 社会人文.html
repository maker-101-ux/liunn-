<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>北京社会人文数据可视化</title>
    <link rel="stylesheet" href="./css/css.css">
    <link rel="stylesheet" href="./css/跟踪导航栏.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", Arial, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, #2c3e50, #4a69bd);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            padding: 1.5rem;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #4a69bd;
            font-size: 1.5rem;
        }

        .full-width-card {
            grid-column: 1 / -1;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin-top: 1rem;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background-color: #f0f4f8;
            color: #2c3e50;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 3rem;
        }

        /* 响应式布局 */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 2rem;
            }

            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
<!-- 过度动画 -->
    <div class="loading">
        <svg viewbox='0 0 50 50'>
            <circle r='25' cx='25' cy='25'></circle>
        </svg>
        <p>LOADING</p>
    </div>
    <!-- <p onclick="loading.in('./page2.html')" class="title">dasd </p> -->
    <!-- 在 <body> 内任意位置添加测试按钮 -->


    <script>
        // JIEJOE produce
        // b站主页：https://space.bilibili.com/3546390319860710
        const loading = {
            container: document.querySelector(".loading"),
            in(target) {
                this.container.classList.remove("loading_out");
                setTimeout(() => {
                    window.location.href = target;
                }, 1000)
            },
            out() {
                this.container.classList.add("loading_out");
            }
        };
        window.addEventListener("load", () => {
            loading.out();
        })
    </script>

    <!-- 过度动画 -->

    <header>
        <h1>北京社会人文数据</h1>
        <p>聚焦首都人口、文化、经济、非遗的多维数据呈现</p>
    </header>

    <div class="container">
        <!-- 卡片1：北京常住人口结构（饼图） -->
        <div class="card">
            <h2>北京常住人口结构（2024年）</h2>
            <div class="chart-container" id="populationPie"></div>
            <div class="legend" id="populationLegend"></div>
        </div>

        <!-- 卡片2：北京核心城区人口密度（柱状图） -->
        <div class="card">
            <h2>北京核心城区人口密度（人/平方公里）</h2>
            <div class="chart-container" id="densityBar"></div>
        </div>

        <!-- 卡片3：北京历史文化地标分布（SVG + D3力导向图） -->
        <div class="card full-width-card">
            <h2>北京历史文化地标分布</h2>
            <div class="chart-container" id="landmarkForce"></div>
            <table>
                <thead>
                    <tr>
                        <th>地标名称</th>
                        <th>所属区域</th>
                        <th>历史年代</th>
                        <th>保护级别</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>故宫博物院</td>
                        <td>东城区</td>
                        <td>明代</td>
                        <td>全国重点文物保护单位</td>
                    </tr>
                    <tr>
                        <td>八达岭长城</td>
                        <td>延庆区</td>
                        <td>明代</td>
                        <td>全国重点文物保护单位</td>
                    </tr>
                    <tr>
                        <td>天坛公园</td>
                        <td>东城区</td>
                        <td>明代</td>
                        <td>全国重点文物保护单位</td>
                    </tr>
                    <tr>
                        <td>颐和园</td>
                        <td>海淀区</td>
                        <td>清代</td>
                        <td>全国重点文物保护单位</td>
                    </tr>
                    <tr>
                        <td>明十三陵</td>
                        <td>昌平区</td>
                        <td>明代</td>
                        <td>全国重点文物保护单位</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 卡片4：北京支柱产业产值（折线图） -->
        <div class="card">
            <h2>北京支柱产业年产值趋势（2020-2024）</h2>
            <div class="chart-container" id="industryLine"></div>
            <div class="legend" id="industryLegend"></div>
        </div>

        <!-- 卡片5：北京非物质文化遗产数量（环形图） -->
        <div class="card">
            <h2>北京非物质文化遗产类别分布</h2>
            <div class="chart-container" id="heritageRing"></div>
        </div>

        <!-- 卡片6：北京居民文化消费支出（分组柱状图） -->
        <div class="card full-width-card">
            <h2>北京居民文化消费支出结构（2024年，单位：元/人）</h2>
            <div class="chart-container" id="consumptionBar"></div>
        </div>
    </div>

        <!-- 底边导航栏 -->
    <div class="bor">
        <div class="nav1">
            <ul>
                <li><a onclick="loading.in('./index.html')" style="cursor: pointer;">首页</a></li>
                <li><a onclick="loading.in('./北京城建.html')" style="cursor: pointer;">城市建设</a></li>
                <li><a onclick="loading.in('./社会人文.html')" style="cursor: pointer;">社会人文</a></li>
                <li><a onclick="loading.in('./自然环境.html')" style="cursor: pointer;">自然环境</a></li>
                <li><a onclick="loading.in('./环境演化.html')" style="cursor: pointer;">环境演化</a></li>
                <li><a onclick="loading.in('./城市演变.html')" style="cursor: pointer;">城市演变</a></li>
                <div class="nav-box"></div>
            </ul>
        </div>
    </div>

        <script>
        const header = document.querySelector('header');
        const img = document.querySelector('.img');
        let scrollDistance = 0;
        let requestId = null;
        function updateHeaderClipPath() {
            const clipPathValue = `polygon(0 0, 100% 0%, 100% ${(scrollDistance <= 600) ? 100 - ((scrollDistance / 600) * 60) : 75}%, 0 100%)`;
            header.style.clipPath = clipPathValue;
            const scaleValue = 1 + ((scrollDistance / 600) * 1);
            img.style.transform = `scale(${scaleValue})`;
            const opacityValue = (scrollDistance / 600);
        }
        function scrollHandler(event) {
            if (event.deltaY < 0) {
                scrollDistance = Math.max(0, scrollDistance + event.deltaY);
            } else {
                scrollDistance = Math.min(600, scrollDistance + event.deltaY);
            }
            if (!requestId) {
                requestId = window.requestAnimationFrame(() => {
                    updateHeaderClipPath();
                    requestId = null;
                });
            }
        }
        window.addEventListener('wheel', scrollHandler);


    </script>

    <script src="./JS/跟踪导航栏.js"></script>
    <!-- 底边导航栏 -->

    <footer>
        <p></p>
    </footer>

    <script>
        // 1. 常住人口结构饼图
        const populationData = [
            { name: "城镇人口", value: 1890, color: "#4a69bd" },
            { name: "乡村人口", value: 285, color: "#60a3bc" },
            { name: "外来常住人口", value: 735, color: "#82ccdd" },
            { name: "本地户籍人口", value: 1425, color: "#b8e986" }
        ];

        const pieSvg = d3.select("#populationPie")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .append("g")
            .attr("transform", "translate(" + (document.getElementById("populationPie").offsetWidth / 2) + "," + (document.getElementById("populationPie").offsetHeight / 2) + ")");

        const pie = d3.pie().value(d => d.value);
        const arc = d3.arc().innerRadius(0).outerRadius(100);
        const outerArc = d3.arc().innerRadius(120).outerRadius(120);

        const piePaths = pieSvg.selectAll("path")
            .data(pie(populationData))
            .enter()
            .append("path")
            .attr("d", arc)
            .attr("fill", d => d.data.color)
            .attr("stroke", "white")
            .style("stroke-width", "2px")
            .style("opacity", 0.8);

        // 饼图图例
        const legend = d3.select("#populationLegend");
        populationData.forEach(d => {
            legend.append("div")
                .attr("class", "legend-item")
                .append("div")
                .attr("class", "legend-color")
                .style("background-color", d.color);
            legend.selectAll(".legend-item:last-child")
                .append("span")
                .text(d.name + "：" + d.value + " 万人");
        });

        // 2. 核心城区人口密度柱状图
        const densityData = [
            { district: "东城区", density: 21500 },
            { district: "西城区", density: 25800 },
            { district: "朝阳区", density: 14200 },
            { district: "海淀区", density: 9800 },
            { district: "丰台区", density: 8500 },
            { district: "石景山区", density: 6300 }
        ];

        const barSvg = d3.select("#densityBar")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%");

        const margin = { top: 20, right: 20, bottom: 50, left: 60 };
        const barWidth = document.getElementById("densityBar").offsetWidth - margin.left - margin.right;
        const barHeight = document.getElementById("densityBar").offsetHeight - margin.top - margin.bottom;

        const barG = barSvg.append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`);

        const xScale = d3.scaleBand()
            .domain(densityData.map(d => d.district))
            .range([0, barWidth])
            .padding(0.1);

        const yScale = d3.scaleLinear()
            .domain([0, d3.max(densityData, d => d.density) + 2000])
            .range([barHeight, 0]);

        // 绘制柱状图
        barG.selectAll("rect")
            .data(densityData)
            .enter()
            .append("rect")
            .attr("x", d => xScale(d.district))
            .attr("y", d => yScale(d.density))
            .attr("width", xScale.bandwidth())
            .attr("height", d => barHeight - yScale(d.density))
            .attr("fill", "#4a69bd")
            .style("opacity", 0.8);

        // 坐标轴
        barG.append("g")
            .attr("transform", `translate(0, ${barHeight})`)
            .call(d3.axisBottom(xScale))
            .selectAll("text")
            .attr("transform", "rotate(-45)")
            .style("text-anchor", "end");

        barG.append("g")
            .call(d3.axisLeft(yScale));

        // 添加坐标轴标签
        barG.append("text")
            .attr("x", barWidth / 2)
            .attr("y", barHeight + margin.bottom - 10)
            .style("text-anchor", "middle")
            .text("城区名称");

        barG.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -margin.left + 20)
            .attr("x", -barHeight / 2)
            .style("text-anchor", "middle")
            .text("人口密度（人/平方公里）");

        // 3. 历史文化地标力导向图
        const landmarkNodes = [
            { id: 1, name: "故宫", group: 1, size: 20 },
            { id: 2, name: "八达岭长城", group: 1, size: 18 },
            { id: 3, name: "天坛", group: 1, size: 16 },
            { id: 4, name: "颐和园", group: 1, size: 16 },
            { id: 5, name: "明十三陵", group: 1, size: 14 },
            { id: 6, name: "南锣鼓巷", group: 2, size: 12 },
            { id: 7, name: "烟袋斜街", group: 2, size: 10 },
            { id: 8, name: "国子监", group: 2, size: 10 },
            { id: 9, name: "雍和宫", group: 1, size: 14 },
            { id: 10, name: "圆明园", group: 1, size: 12 }
        ];

        const landmarkLinks = [
            { source: 1, target: 3, value: 1 },
            { source: 1, target: 9, value: 1 },
            { source: 2, target: 5, value: 1 },
            { source: 4, target: 10, value: 1 },
            { source: 6, target: 7, value: 1 },
            { source: 6, target: 8, value: 1 },
            { source: 1, target: 4, value: 1 }
        ];

        const forceSvg = d3.select("#landmarkForce")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%");

        const forceG = forceSvg.append("g");

        // 力导向图配置
        const simulation = d3.forceSimulation(landmarkNodes)
            .force("link", d3.forceLink(landmarkLinks).id(d => d.id).distance(100))
            .force("charge", d3.forceManyBody().strength(-200))
            .force("center", d3.forceCenter(
                document.getElementById("landmarkForce").offsetWidth / 2,
                document.getElementById("landmarkForce").offsetHeight / 2
            ));

        // 绘制连线
        const links = forceG.selectAll("line")
            .data(landmarkLinks)
            .enter()
            .append("line")
            .attr("stroke", "#b0bEC5")
            .attr("stroke-width", 1);

        // 绘制节点
        const nodes = forceG.selectAll("circle")
            .data(landmarkNodes)
            .enter()
            .append("circle")
            .attr("r", d => d.size)
            .attr("fill", d => d.group === 1 ? "#4a69bd" : "#82ccdd")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // 节点文字
        const nodeTexts = forceG.selectAll("text")
            .data(landmarkNodes)
            .enter()
            .append("text")
            .text(d => d.name)
            .attr("font-size", 12)
            .attr("dx", d => d.size + 5)
            .attr("dy", 4);

        // 拖拽事件
        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        // 更新力导向图位置
        simulation.on("tick", () => {
            links
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            nodes
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);

            nodeTexts
                .attr("x", d => d.x)
                .attr("y", d => d.y);
        });

        // 4. 支柱产业产值折线图
        const industryData = [
            { year: 2020, tech: 1050, finance: 890, culture: 380, tourism: 250 },
            { year: 2021, tech: 1180, finance: 950, culture: 420, tourism: 320 },
            { year: 2022, tech: 1320, finance: 1020, culture: 480, tourism: 380 },
            { year: 2023, tech: 1480, finance: 1100, culture: 550, tourism: 450 },
            { year: 2024, tech: 1650, finance: 1200, culture: 630, tourism: 520 }
        ];

        const industryKeys = ["tech", "finance", "culture", "tourism"];
        const industryNames = ["信息技术产业", "金融服务业", "文化创意产业", "旅游产业"];
        const industryColors = ["#4a69bd", "#60a3bc", "#82ccdd", "#b8e986"];

        const lineSvg = d3.select("#industryLine")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%");

        const lineMargin = { top: 20, right: 20, bottom: 50, left: 60 };
        const lineWidth = document.getElementById("industryLine").offsetWidth - lineMargin.left - lineMargin.right;
        const lineHeight = document.getElementById("industryLine").offsetHeight - lineMargin.top - lineMargin.bottom;

        const lineG = lineSvg.append("g")
            .attr("transform", `translate(${lineMargin.left}, ${lineMargin.top})`);

        const xLineScale = d3.scaleLinear()
            .domain(d3.extent(industryData, d => d.year))
            .range([0, lineWidth]);

        const yLineScale = d3.scaleLinear()
            .domain([0, d3.max(industryData, d => Math.max(d.tech, d.finance, d.culture, d.tourism)) + 200])
            .range([lineHeight, 0]);

        // 绘制折线
        industryKeys.forEach((key, index) => {
            const line = d3.line()
                .x(d => xLineScale(d.year))
                .y(d => yLineScale(d[key]));

            lineG.append("path")
                .datum(industryData)
                .attr("fill", "none")
                .attr("stroke", industryColors[index])
                .attr("stroke-width", 2)
                .attr("d", line);

            // 数据点
            lineG.selectAll(`.dot-${key}`)
                .data(industryData)
                .enter()
                .append("circle")
                .attr("class", `dot-${key}`)
                .attr("cx", d => xLineScale(d.year))
                .attr("cy", d => yLineScale(d[key]))
                .attr("r", 4)
                .attr("fill", industryColors[index]);
        });

        // 折线图坐标轴
        lineG.append("g")
            .attr("transform", `translate(0, ${lineHeight})`)
            .call(d3.axisBottom(xLineScale).tickFormat(d3.format("d")));

        lineG.append("g")
            .call(d3.axisLeft(yLineScale));

        // 折线图图例
        const industryLegend = d3.select("#industryLegend");
        industryNames.forEach((name, index) => {
            industryLegend.append("div")
                .attr("class", "legend-item")
                .append("div")
                .attr("class", "legend-color")
                .style("background-color", industryColors[index]);
            industryLegend.selectAll(".legend-item:last-child")
                .append("span")
                .text(name);
        });

        // 5. 非物质文化遗产环形图
        const heritageData = [
            { name: "传统技艺", value: 38, color: "#4a69bd" },
            { name: "传统舞蹈", value: 12, color: "#60a3bc" },
            { name: "传统戏剧", value: 15, color: "#82ccdd" },
            { name: "传统美术", value: 25, color: "#b8e986" },
            { name: "民间文学", value: 8, color: "#f6b93b" },
            { name: "传统音乐", value: 10, color: "#e55039" }
        ];

        const ringSvg = d3.select("#heritageRing")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .append("g")
            .attr("transform", "translate(" + (document.getElementById("heritageRing").offsetWidth / 2) + "," + (document.getElementById("heritageRing").offsetHeight / 2) + ")");

        const ring = d3.pie().value(d => d.value);
        const innerArc = d3.arc().innerRadius(60).outerRadius(100);

        ringSvg.selectAll("path")
            .data(ring(heritageData))
            .enter()
            .append("path")
            .attr("d", innerArc)
            .attr("fill", d => d.data.color)
            .attr("stroke", "white")
            .style("stroke-width", "2px")
            .style("opacity", 0.8);

        // 环形图中心文字
        ringSvg.append("text")
            .attr("text-anchor", "middle")
            .attr("font-size", 16)
            .text("总计 108 项")
            .attr("dy", 0);

        ringSvg.append("text")
            .attr("text-anchor", "middle")
            .attr("font-size", 12)
            .text("北京非遗项目")
            .attr("dy", "2em");

        // 6. 居民文化消费支出分组柱状图
        const consumptionData = [
            { type: "文艺演出", urban: 890, rural: 230 },
            { type: "博物馆参观", urban: 650, rural: 180 },
            { type: "图书报刊", urban: 480, rural: 150 },
            { type: "影视娱乐", urban: 720, rural: 210 },
            { type: "非遗体验", urban: 560, rural: 120 },
            { type: "文化培训", urban: 620, rural: 100 }
        ];

        const consumptionSvg = d3.select("#consumptionBar")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%");

        const consumptionMargin = { top: 20, right: 20, bottom: 50, left: 60 };
        const consumptionWidth = document.getElementById("consumptionBar").offsetWidth - consumptionMargin.left - consumptionMargin.right;
        const consumptionHeight = document.getElementById("consumptionBar").offsetHeight - consumptionMargin.top - consumptionMargin.bottom;

        const consumptionG = consumptionSvg.append("g")
            .attr("transform", `translate(${consumptionMargin.left}, ${consumptionMargin.top})`);

        // 分组柱状图比例尺
        const xConsumptionScale = d3.scaleBand()
            .domain(consumptionData.map(d => d.type))
            .range([0, consumptionWidth])
            .padding(0.2);

        const xSubScale = d3.scaleBand()
            .domain(["urban", "rural"])
            .range([0, xConsumptionScale.bandwidth()])
            .padding(0.1);

        const yConsumptionScale = d3.scaleLinear()
            .domain([0, d3.max(consumptionData, d => Math.max(d.urban, d.rural)) + 200])
            .range([consumptionHeight, 0]);

        // 绘制分组柱子
        const groups = consumptionG.selectAll("g")
            .data(consumptionData)
            .enter()
            .append("g")
            .attr("transform", d => `translate(${xConsumptionScale(d.type)}, 0)`);

        groups.selectAll("rect")
            .data(d => [
                { key: "urban", value: d.urban, color: "#4a69bd" },
                { key: "rural", value: d.rural, color: "#82ccdd" }
            ])
            .enter()
            .append("rect")
            .attr("x", d => xSubScale(d.key))
            .attr("y", d => yConsumptionScale(d.value))
            .attr("width", xSubScale.bandwidth())
            .attr("height", d => consumptionHeight - yConsumptionScale(d.value))
            .attr("fill", d => d.color);

        // 分组柱状图坐标轴
        consumptionG.append("g")
            .attr("transform", `translate(0, ${consumptionHeight})`)
            .call(d3.axisBottom(xConsumptionScale))
            .selectAll("text")
            .attr("transform", "rotate(-45)")
            .style("text-anchor", "end");

        consumptionG.append("g")
            .call(d3.axisLeft(yConsumptionScale));

        // 分组柱状图图例
        const consumptionLegend = consumptionG.append("g")
            .attr("transform", `translate(${consumptionWidth / 2}, ${consumptionHeight + 30})`)
            .attr("class", "legend");

        consumptionLegend.append("rect")
            .attr("x", -50)
            .attr("y", 0)
            .attr("width", 15)
            .attr("height", 15)
            .attr("fill", "#4a69bd");

        consumptionLegend.append("text")
            .attr("x", -30)
            .attr("y", 12)
            .text("城镇居民")
            .style("font-size", 12);

        consumptionLegend.append("rect")
            .attr("x", 20)
            .attr("y", 0)
            .attr("width", 15)
            .attr("height", 15)
            .attr("fill", "#82ccdd");

        consumptionLegend.append("text")
            .attr("x", 40)
            .attr("y", 12)
            .text("农村居民")
            .style("font-size", 12);
    </script>
</body>
</html>